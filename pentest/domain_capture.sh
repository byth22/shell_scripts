#/usr/bin/bash


# First arg = domain
# Second arg = type of information [all/reserv]
#  all = all domains and subdomains
#  reserv = pointed domain only

all()
{
  cat index.html | grep -o 'http[s]://[^"]*' | cut -d "/" -f 3 | sort -u > domain.txt
}

reserv()
{
  cat index.html | grep -o 'http[s]://[^"]*' | cut -d "/" -f 3 | sort -u | grep "$nameFind" > domain.txt
}

banner()
{
  echo""
  echo "-- DOM CAPTURE --"
  echo ""
}

end()
{
  echo ""
  echo "    [+] Resolução concluida. Nomes de domínios gravados no arquivo dom.txt e IPs resolvidos abaixo."
}

process()
{
  echo""
  for url in $(cat domain.txt); do host $url; done | grep "has address" | cut -d " " -f 4 | sort -u
}

capture()
{
  wget "$nameFind" 2> /dev/null
  echo "    [+] Captura realizada. Aguarde a resolução de IPs."
}

rm index.html 2> /dev/null
banner

if [ $# -ne 2 ]; then
  echo "[*] Faltam 2 argumentos."
  echo ""
  echo "    [-] Usage: ./dom_capture.sh + domain + all OR reserv"
  exit 1
fi

nameFind="$1" # é preciso declarar fora das funções p/ que funcione

if [ "$2" == "all" ]; then
  capture
  all
  end
  process

elif [ "$2" == "reserv" ]; then
  capture
  reserv
  end
  process

else
  echo""
  echo "    [-] Argumento inválido. Verifique o cod. fonte p/ mais informações."
  echo""
  exit
fi
